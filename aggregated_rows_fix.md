# Исправление логики кнопок коллапсирования для агрегированных строк

## Проблема
У агрегированных строк (например, H1, H2, Q1, Q2) не появлялись кнопки коллапсирования для раскрытия их дочерних элементов.

## Причина
Предыдущая логика `shouldShowCollapseButton` была слишком сложной и не правильно определяла, когда показывать кнопку коллапсирования.

## Решение

### Новая упрощенная логика
```javascript
shouldShowCollapseButton(rowKey, allRowKeys, rowFieldValues, level) {
    // 1. Проверяем, есть ли дочерние элементы для этого уровня
    const hasChildren = this.hasChildrenForLevel(allRowKeys, level);
    if (!hasChildren) return false;
    
    // 2. Определяем максимальный уровень детализации в данных
    const rowFields = rowKey.split('|');
    const maxLevel = Math.max(...allRowKeys.map(key => key.split('|').length - 1));
    
    // 3. Проверяем, является ли это агрегированной строкой
    const isAggregatedRow = rowFields.length - 1 < maxLevel;
    
    // 4. Кнопка показывается для агрегированных строк с дочерними элементами
    return isAggregatedRow && hasChildren;
}
```

### Логика определения агрегированных строк
- **Агрегированная строка** - строка, которая имеет меньше уровней детализации, чем максимальный уровень в данных
- **Детализированная строка** - строка с максимальным уровнем детализации (например, месяцы)

### Пример работы с вашими данными:

**Структура данных:**
- Уровень 0: Год (2024, 2025, 2026)
- Уровень 1: Полугодие (H1, H2) 
- Уровень 2: Квартал (Q1, Q2, Q3, Q4)
- Уровень 3: Месяц (1, 2, 3, ..., 12)

**Максимальный уровень детализации:** 3 (месяцы)

**Кнопки коллапсирования показываются для:**
- ✅ Год (уровень 0 < 3) - для раскрытия полугодий
- ✅ Полугодие (уровень 1 < 3) - для раскрытия кварталов  
- ✅ Квартал (уровень 2 < 3) - для раскрытия месяцев
- ❌ Месяц (уровень 3 = 3) - это детализированная строка

## Результат
Теперь у всех агрегированных строк (H1, H2, Q1, Q2, Q3, Q4) появляются кнопки коллапсирования для раскрытия их дочерних элементов.

Приложение запущено на http://localhost:5001 для тестирования.
