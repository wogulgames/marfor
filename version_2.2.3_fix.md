# Версия 2.2.3 - Исправление логики кнопок коллапсирования

## Проблема
У агрегированных строк (H1, H2, Q1, Q2, Q3, Q4) не появлялись кнопки коллапсирования для раскрытия их дочерних элементов.

## Причина
Логика `shouldShowCollapseButton` неправильно определяла агрегированные строки, сравнивая длину строки с максимальной длиной во всех данных, что не учитывало контекст видимых полей.

## Исправление

### Новая логика определения агрегированных строк:
```javascript
shouldShowCollapseButton(rowKey, allRowKeys, rowFieldValues, level) {
    // 1. Проверяем, есть ли дочерние элементы для этого уровня
    const hasChildren = this.hasChildrenForLevel(allRowKeys, level);
    if (!hasChildren) return false;
    
    // 2. Проверяем, является ли это агрегированной строкой
    // Агрегированная строка - это строка, которая имеет дочерние строки 
    // с большим количеством уровней
    const hasChildRows = allRowKeys.some(key => {
        const keyFields = key.split('|');
        const currentFields = rowKey.split('|');
        
        // Дочерняя строка должна начинаться с того же префикса, 
        // но иметь больше уровней
        if (keyFields.length <= currentFields.length) return false;
        
        // Проверяем, что текущая строка является префиксом дочерней строки
        return currentFields.every((field, index) => field === keyFields[index]);
    });
    
    return hasChildren && hasChildRows;
}
```

### Как работает новая логика:

**Пример с данными:**
- Строка `"2024"` (год) → проверяет, есть ли строки типа `"2024|H1"`, `"2024|H2"` → ДА → показывает кнопку
- Строка `"2024|H1"` (полугодие) → проверяет, есть ли строки типа `"2024|H1|Q1"`, `"2024|H1|Q2"` → ДА → показывает кнопку  
- Строка `"2024|H1|Q1|1"` (месяц) → проверяет, есть ли строки с большим количеством уровней → НЕТ → не показывает кнопку

## Результат
✅ Кнопки коллапсирования теперь появляются у всех агрегированных строк
✅ Возможность раскрыть конкретное полугодие или квартал
✅ Правильное скрытие/показ дочерних элементов

**Приложение запущено на http://localhost:5001 с версией 2.2.3**
